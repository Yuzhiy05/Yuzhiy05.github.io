<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.18" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><meta property="og:url" content="https://github.com/Yuzhiy05/Yuzhiy05.github.io/article/bijxvme0/"><meta property="og:title" content="编写cmake"><meta property="og:description" content="cmake 各变量名字 PROJECT_SOURCE_DIR 表示当前项目的根目录也就是当前cmakelist文件所在路径。调用project(xxx)指定项目后的源代码目录 PROJECT_BINARY_DIR 项目的构建目录通常都在构建文件夹下(build)文件夹下 当使用Bbuild 或指定构建文件夹. CMAKE_CURRENT_SOURCE_..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2026-01-29T08:58:26.000Z"><meta property="article:modified_time" content="2026-01-29T08:58:26.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"编写cmake","image":[""],"dateModified":"2026-01-29T08:58:26.000Z","author":[]}</script><link rel="icon" href="/jager.ico"><title>编写cmake</title><meta name="description" content="cmake 各变量名字 PROJECT_SOURCE_DIR 表示当前项目的根目录也就是当前cmakelist文件所在路径。调用project(xxx)指定项目后的源代码目录 PROJECT_BINARY_DIR 项目的构建目录通常都在构建文件夹下(build)文件夹下 当使用Bbuild 或指定构建文件夹. CMAKE_CURRENT_SOURCE_..."><link rel="preload" href="/assets/style-Digo8I4Z.css" as="style"><link rel="stylesheet" href="/assets/style-Digo8I4Z.css"><link rel="modulepreload" href="/assets/app-BKjZcyMZ.js"><link rel="modulepreload" href="/assets/index.html-BpzqHJlL.js"><link rel="prefetch" href="/assets/index.html-BDmyHPBZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CkxXW4NM.js" as="script"><link rel="prefetch" href="/assets/index.html-YZ9EWVrS.js" as="script"><link rel="prefetch" href="/assets/index.html-B8lo7q3T.js" as="script"><link rel="prefetch" href="/assets/index.html-C8EkFxSW.js" as="script"><link rel="prefetch" href="/assets/index.html-DTZK_Obj.js" as="script"><link rel="prefetch" href="/assets/index.html-BqK_ywhh.js" as="script"><link rel="prefetch" href="/assets/index.html-BX53du6-.js" as="script"><link rel="prefetch" href="/assets/index.html-BDaPhhiE.js" as="script"><link rel="prefetch" href="/assets/index.html-D0yV9xRf.js" as="script"><link rel="prefetch" href="/assets/index.html-COblnezV.js" as="script"><link rel="prefetch" href="/assets/index.html-CXPgUpLt.js" as="script"><link rel="prefetch" href="/assets/index.html-CCULxEIw.js" as="script"><link rel="prefetch" href="/assets/index.html-CdkdkFKV.js" as="script"><link rel="prefetch" href="/assets/index.html-cNdmztDu.js" as="script"><link rel="prefetch" href="/assets/index.html-D_j3a6ru.js" as="script"><link rel="prefetch" href="/assets/index.html-CS2f86WC.js" as="script"><link rel="prefetch" href="/assets/index.html-2iyLC4wg.js" as="script"><link rel="prefetch" href="/assets/index.html-BYbw2ge4.js" as="script"><link rel="prefetch" href="/assets/index.html-hTZBD_pS.js" as="script"><link rel="prefetch" href="/assets/index.html-wCTXj0vv.js" as="script"><link rel="prefetch" href="/assets/index.html-CO33U8vu.js" as="script"><link rel="prefetch" href="/assets/index.html-D5W7F7i9.js" as="script"><link rel="prefetch" href="/assets/index.html-Cc1QXAbZ.js" as="script"><link rel="prefetch" href="/assets/index.html-B_LYIcAY.js" as="script"><link rel="prefetch" href="/assets/index.html-CuFXejKm.js" as="script"><link rel="prefetch" href="/assets/index.html-U8o5EgUp.js" as="script"><link rel="prefetch" href="/assets/index.html-ByDXid-0.js" as="script"><link rel="prefetch" href="/assets/index.html-Dx0TgkFp.js" as="script"><link rel="prefetch" href="/assets/index.html-DrAvEd0C.js" as="script"><link rel="prefetch" href="/assets/index.html-hYOD89FR.js" as="script"><link rel="prefetch" href="/assets/index.html-CyqTdI65.js" as="script"><link rel="prefetch" href="/assets/index.html-COWagPwm.js" as="script"><link rel="prefetch" href="/assets/index.html-Bg6SvAkg.js" as="script"><link rel="prefetch" href="/assets/index.html-BJqbukTz.js" as="script"><link rel="prefetch" href="/assets/index.html-CnDpICHW.js" as="script"><link rel="prefetch" href="/assets/index.html-CGbN0XYa.js" as="script"><link rel="prefetch" href="/assets/index.html-jS80KsI2.js" as="script"><link rel="prefetch" href="/assets/index.html-EtDWrKDU.js" as="script"><link rel="prefetch" href="/assets/index.html-CH31B5d1.js" as="script"><link rel="prefetch" href="/assets/index.html-BhPcYC2O.js" as="script"><link rel="prefetch" href="/assets/index.html-DrkEZcGx.js" as="script"><link rel="prefetch" href="/assets/index.html-DXu6Aapb.js" as="script"><link rel="prefetch" href="/assets/index.html-C0uT99Tv.js" as="script"><link rel="prefetch" href="/assets/index.html-C0xSnZJf.js" as="script"><link rel="prefetch" href="/assets/index.html-GiooqLFA.js" as="script"><link rel="prefetch" href="/assets/index.html-DjV7xjKN.js" as="script"><link rel="prefetch" href="/assets/index.html-CycU8CmD.js" as="script"><link rel="prefetch" href="/assets/index.html-D7VCTBmG.js" as="script"><link rel="prefetch" href="/assets/index.html-TBuZ6q_K.js" as="script"><link rel="prefetch" href="/assets/404.html-ETiV6QZS.js" as="script"><link rel="prefetch" href="/assets/index.html-DaU1ZE50.js" as="script"><link rel="prefetch" href="/assets/index.html-gkbMOajF.js" as="script"><link rel="prefetch" href="/assets/index.html-B3Hcx5X9.js" as="script"><link rel="prefetch" href="/assets/index.html-CKBuJMSQ.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/assets/searchBox-default-SoFY8ZEF.js" as="script"><link rel="prefetch" href="/assets/SearchBox-C1NP_If_.js" as="script"><link rel="prefetch" href="/assets/setupDevtools-7MC2TMWH-B0XusQKQ.js" as="script"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-8e3384c8><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f619d75a></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-f619d75a> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-8e3384c8 data-v-08ba35c6><div class="vp-navbar" vp-navbar data-v-08ba35c6 data-v-249014c1><div class="wrapper" data-v-249014c1><div class="container" data-v-249014c1><div class="title" data-v-249014c1><div class="vp-navbar-title" data-v-249014c1 data-v-1d78d633><a class="vp-link no-icon link title" href="/" data-v-1d78d633 data-v-5fc5bb72><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" src="/pro2.png" alt data-v-c868529b><!--]--><!--[--><img class="vp-image light logo" src="/pro2.png" alt data-v-c868529b><!--]--><!--]--><!--]--><span data-v-1d78d633></span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-249014c1><div class="content-body" data-v-249014c1><!--[--><!--]--><div class="vp-navbar-search search" data-v-249014c1><div class="search-wrapper" data-v-25b97326><!----><div id="local-search" data-v-25b97326><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-25b97326><span class="mini-search-button-container"><svg class="mini-search-search-icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-249014c1 data-v-9b4f56d1><span id="main-nav-aria-label" class="visually-hidden" data-v-9b4f56d1>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-9b4f56d1 data-v-64cbb49b data-v-5fc5bb72><!--[--><!----><span data-v-64cbb49b>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link active" href="/blog/" tabindex="0" data-v-9b4f56d1 data-v-64cbb49b data-v-5fc5bb72><!--[--><!----><span data-v-64cbb49b>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/projects/" tabindex="0" data-v-9b4f56d1 data-v-64cbb49b data-v-5fc5bb72><!--[--><!----><span data-v-64cbb49b>Projects</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-9b4f56d1 data-v-6f692087><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6f692087><span class="text" data-v-6f692087><!----><!----><span data-v-6f692087>技术文档</span><span class="vpi-chevron-down text-icon" data-v-6f692087></span></span></button><div class="menu" data-v-6f692087><div class="vp-menu" data-v-6f692087 data-v-1db819e8><div class="items" data-v-1db819e8><!--[--><!--[--><div class="vp-menu-group" data-v-1db819e8 data-v-00200c12><p class="title" data-v-00200c12><!----><span data-v-00200c12>c++</span></p><!--[--><!--[--><div class="vp-menu-link" data-v-00200c12 data-v-4d5b3584><a class="vp-link no-icon link" href="https://zh.cppreference.com/w/cpp" target="_blank" rel="noreferrer" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> cppreference<!--]--><span class="vpi-external-link icon" data-v-5fc5bb72></span></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-00200c12 data-v-4d5b3584><a class="vp-link no-icon link" href="https://github.com/llvm/llvm-project/blob/main/libcxx/include/__utility/exception_guard.h" target="_blank" rel="noreferrer" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> libc++<!--]--><span class="vpi-external-link icon" data-v-5fc5bb72></span></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="vp-menu-group" data-v-1db819e8 data-v-00200c12><p class="title" data-v-00200c12><!----><span data-v-00200c12>C#</span></p><!--[--><!--[--><div class="vp-menu-link" data-v-00200c12 data-v-4d5b3584><a class="vp-link no-icon link" href="https://learn.microsoft.com/zh-cn/windows/apps/how-tos/hello-world-winui3" target="_blank" rel="noreferrer" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> winui3<!--]--><span class="vpi-external-link icon" data-v-5fc5bb72></span></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-00200c12 data-v-4d5b3584><a class="vp-link no-icon link" href="https://learn.microsoft.com/zh-cn/dotnet/api/system.windows.forms.richtextbox?view=windowsdesktop-8.0" target="_blank" rel="noreferrer" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> winfrom<!--]--><span class="vpi-external-link icon" data-v-5fc5bb72></span></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-9b4f56d1 data-v-6f692087><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6f692087><span class="text" data-v-6f692087><!----><!----><span data-v-6f692087>笔记</span><span class="vpi-chevron-down text-icon" data-v-6f692087></span></span></button><div class="menu" data-v-6f692087><div class="vp-menu" data-v-6f692087 data-v-1db819e8><div class="items" data-v-1db819e8><!--[--><!--[--><div class="vp-menu-link" data-v-1db819e8 data-v-4d5b3584><a class="vp-link no-icon link" href="/test1/" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> 线性代数<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-1db819e8 data-v-4d5b3584><a class="vp-link no-icon link" href="/data_struct/" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> 数据结构<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-1db819e8 data-v-4d5b3584><a class="vp-link no-icon link" href="/math/" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> 数学<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-9b4f56d1 data-v-6f692087><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6f692087><span class="text" data-v-6f692087><!----><!----><span data-v-6f692087>更多</span><span class="vpi-chevron-down text-icon" data-v-6f692087></span></span></button><div class="menu" data-v-6f692087><div class="vp-menu" data-v-6f692087 data-v-1db819e8><div class="items" data-v-1db819e8><!--[--><!--[--><div class="vp-menu-link" data-v-1db819e8 data-v-4d5b3584><a class="vp-link no-icon link" href="/ebooks/" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> 书籍推荐<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-1db819e8 data-v-4d5b3584><a class="vp-link no-icon link" href="/sites-collect/" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> 站点导航<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-1db819e8 data-v-4d5b3584><a class="vp-link no-icon link" href="/cli/" data-v-4d5b3584 data-v-5fc5bb72><!--[--><!----> Command-Line Interface<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-249014c1 data-v-ee9b4cd0><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-ee9b4cd0 data-v-03deaf29 data-v-b6adca12><span class="check" data-v-b6adca12><span class="icon" data-v-b6adca12><!--[--><span class="vpi-sun sun" data-v-03deaf29></span><span class="vpi-moon moon" data-v-03deaf29></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-249014c1 data-v-ed605820 data-v-889f5ff1><!--[--><a class="vp-social-link no-icon" href="https://github.com/Yuzhiy05/Yuzhiy05.github.io" aria-label="github" target="_blank" rel="noopener" data-v-889f5ff1 data-v-85ef9c5c><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-249014c1 data-v-8b92884e data-v-6f692087><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6f692087><span class="vpi-more-horizontal icon" data-v-6f692087></span></button><div class="menu" data-v-6f692087><div class="vp-menu" data-v-6f692087 data-v-1db819e8><!----><!--[--><!--[--><!----><div class="group" data-v-8b92884e><div class="item appearance" data-v-8b92884e><p class="label" data-v-8b92884e>外观</p><div class="appearance-action" data-v-8b92884e><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-8b92884e data-v-03deaf29 data-v-b6adca12><span class="check" data-v-b6adca12><span class="icon" data-v-b6adca12><!--[--><span class="vpi-sun sun" data-v-03deaf29></span><span class="vpi-moon moon" data-v-03deaf29></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8b92884e><div class="item social-links" data-v-8b92884e><div class="vp-social-links social-links-list" data-v-8b92884e data-v-889f5ff1><!--[--><a class="vp-social-link no-icon" href="https://github.com/Yuzhiy05/Yuzhiy05.github.io" aria-label="github" target="_blank" rel="noopener" data-v-889f5ff1 data-v-85ef9c5c><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-249014c1 data-v-5e4996b9><span class="container" data-v-5e4996b9><span class="top" data-v-5e4996b9></span><span class="middle" data-v-5e4996b9></span><span class="bottom" data-v-5e4996b9></span></span></button></div></div></div></div><div class="divider" data-v-249014c1><div class="divider-line" data-v-249014c1></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-8e3384c8 data-v-7d032704><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-7d032704><span class="vpi-align-left menu-icon" data-v-7d032704></span><span class="menu-text" data-v-7d032704>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-7d032704 data-v-a578d39d><button data-v-a578d39d>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-8e3384c8 data-v-db28ea6c><div class="is-blog vp-doc-container" data-v-dbb2a29f><!--[--><!--]--><div class="container" data-v-dbb2a29f><!----><div class="content" data-v-dbb2a29f><div class="content-container" data-v-dbb2a29f><!--[--><!--]--><main class="main" data-v-dbb2a29f><nav class="vp-breadcrumb" data-v-dbb2a29f data-v-a8981ee2><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-a8981ee2><!--[--><li property="itemListElement" typeof="ListItem" data-v-a8981ee2><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-a8981ee2 data-v-5fc5bb72><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-a8981ee2></span><meta property="name" content="首页" data-v-a8981ee2><meta property="position" content="1" data-v-a8981ee2></li><li property="itemListElement" typeof="ListItem" data-v-a8981ee2><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-a8981ee2 data-v-5fc5bb72><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-a8981ee2></span><meta property="name" content="博客" data-v-a8981ee2><meta property="position" content="2" data-v-a8981ee2></li><li property="itemListElement" typeof="ListItem" data-v-a8981ee2><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=4a9315" property="item" typeof="WebPage" data-v-a8981ee2 data-v-5fc5bb72><!--[-->tools<!--]--><!----></a><span class="vpi-chevron-right" data-v-a8981ee2></span><meta property="name" content="tools" data-v-a8981ee2><meta property="position" content="3" data-v-a8981ee2></li><li property="itemListElement" typeof="ListItem" data-v-a8981ee2><a class="vp-link no-icon link breadcrumb current" href="/article/bijxvme0/" property="item" typeof="WebPage" data-v-a8981ee2 data-v-5fc5bb72><!--[-->编写cmake<!--]--><!----></a><!----><meta property="name" content="编写cmake" data-v-a8981ee2><meta property="position" content="4" data-v-a8981ee2></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-a014377c>编写cmake <!----></h1><div class="vp-doc-meta" data-v-a014377c><p class="reading-time" data-v-a014377c><span class="vpi-books icon" data-v-a014377c></span><span data-v-a014377c>9836字</span><span data-v-a014377c>约33分钟</span></p><!----><p class="create-time" data-v-a014377c><span class="vpi-clock icon" data-v-a014377c></span><span data-v-a014377c>2024-12-26</span></p></div><!--]--><div class="vp-doc plume-content _article_bijxvme0_ external-link-icon-enabled" vp-content data-v-dbb2a29f><p>cmake 各变量名字</p><p>PROJECT_SOURCE_DIR 表示当前项目的根目录也就是当前cmakelist文件所在路径。调用project(xxx)指定项目后的源代码目录</p><p>PROJECT_BINARY_DIR 项目的构建目录通常都在构建文件夹下(build)文件夹下 当使用Bbuild 或指定构建文件夹.</p><p>CMAKE_CURRENT_SOURCE_DIR 表示当前CMakeLists.txt 所在的源码目录 CMAKE_CURRENT_BINARY_DIR 表示当前输出目录的位置</p><p>CMAKE_SOURCE_DIR：根项目源码路径最外层cmakeList（存放main.cpp的地方） CMAKE_BINARY_DIR：根项目输出路径（存放main.exe的地方）</p><p>PROJECT_IS_TOP_LEVEL：BOOL类型，表示当前项目是否是（最顶层的）根项目 PROJECT_NAME：当前项目名 CMAKE_PROJECT_NAME：根项目的项目名</p><p>EXECUTABLE_OUTPUT_PATH 可执行文件的输出路径(旧变量不建议使用，可能不生效) CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE 使用此项代替</p><p>LIBRARY_OUTPUT_PATH 库文件的输出路径(旧变量不建议使用，可能不生效) CMAKE_ARCHIVE_OUTPUT_DIRECTORY 静态库输出路径 CMAKE_LIBRARY_OUTPUT_DIRECTORY 动态库输出路径</p><p>小技巧：CMake 的 ${} 表达式可以嵌套</p><p>CMAKE_CXX_STANDARD 是一个整数，表示要用的 C++ 标准。 比如需要 C++17 那就设为 17，需要 C++23 就设为 23。</p><p>CMAKE_CXX_STANDARD_REQUIRED 是 BOOL 类型，可以为 ON 或 OFF，默认OFF。 他表示是否一定要支持你指定的 C++ 标准：如果为 OFF 则 CMake 检测到编译器不支持 C++17 时不报错，而是默默调低到 C++14 给你用；为 ON 则发现不支持报错，更安全。 通常我们设为ON。 CMAKE_CXX_EXTENSIONS 也是 BOOL 类型，默认为 ON。 设为 ON 表示启用 GCC 特有的一些扩展功能；OFF 则关闭 GCC 的扩展功能，只使用标准的 C++。 要兼容其他编译器（如 MSVC）的项目，都会设为 OFF 防止不小心用了 GCC 才有的特性。 通常我们设为OFF</p><p>CMAKE_BUILD_TOOL: 执行构建过程的工具。该变量设置为CMake构建时输出所需的程序。对于VS 6， CMAKE_BUILD_TOOL设置为msdev， 对于Unix，它被设置为make 或 gmake。 对于 VS 7， 它被设置为devenv. 对于Nmake构建文件，它的值为nmake。 CMAKE_DL_LIBS: 包含dlopen和dlclose的库的名称。 CMAKE_COMMAND: 指向cmake可执行程序的全路径。 CMAKE_CTEST_COMMAND: 指向ctest可执行程序的全路径。 CMAKE_EDIT_COMMAND: cmake-gui或ccmake的全路径。 CMAKE_EXECUTABLE_SUFFIX: 该平台上可执行程序的后缀。 CMAKE_SIZEOF_VOID_P: void指针的大小。 CMAKE_SKIP_RPATH: 如果为真，将不添加运行时路径信息。默认情况下是如果平台支持运行时信息，将会添加运行时信息到可执行程序当中。这样从构建树中运行程序将很容易。为了在安装过程中忽略掉RPATH，使用CMAKE_SKIP_INSTALL_RPATH。 CMAKE_GENERATOR: 构建工程的产生器。它将产生构建文件 (e.g. &quot;Unix Makefiles&quot;, &quot;Visual Studio 2019&quot;, etc.)</p><p>从指定目录中搜寻源文件，并将它们存入变量SRC_LIST和CW_SRC_LIST中</p><div class="language-cmake" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">aux_source_directory</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${PROJECT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SRC_LIST)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">aux_source_directory</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${PROJECT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/cw/src CW_SRC_LIST)</span></span></code></pre></div><p>此命令不会递归查找子目录,只会识别.cpp .cc .cxx 不会识别.hpp .h文件 同样CMake 无法生成知道何时添加了新的源文件此时需要重新运行 CMake 一般用作</p><blockquote><p>显式模板实例化的项目。模板实例化文件可以存储在 Template 子目录中，并使用此命令自动收集，以避免手动列出所有实例化</p></blockquote><p>最简单的例子</p><p>获取所有源文件进行编译 有如下文件结构</p><div class="vp-file-tree"><ul><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">helloproject</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">build</span><span class="comment"><br> -...省略</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">src</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">demo1.cpp</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">demo2.cxx</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">demo3.h</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">demo4.hpp</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><span class="name">...</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">src2</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">demo3.cpp</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">CmakeLists.txt</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">CmakePresets.json</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">hello.cpp</span></span><!--]--><!----></li></ul><!--]--><!----></li></ul></div><p>添加src文件夹下所有文件进行编译</p><div class="language-cmake line-numbers-mode" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">cmake_minimum_required</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">VERSION</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 3.5.0)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(CMAKE_CXX_STANDARD 23)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(CMAKE_CXX_STANDARD_REQUIRED </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">true</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(CMAKE_CXX_EXTENSIONS </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">OFF</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">project</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(hello)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;PROJECT_SOURCE_DIR目录为=${PROJECT_SOURCE_DIR}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;PROJECT_BINARY_DIR目录为=${PROJECT_BINARY_DIR}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">aux_source_directory</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${PROJECT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/src SRC_LIST)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">include_directories</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(src)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;源码路径SRC_LIST文件=${SRC_LIST}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_executable</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(hello main.cpp </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${SRC_LIST}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="列出所有源码" tabindex="-1"><a class="header-anchor" href="#列出所有源码"><span>列出所有源码</span></a></h3><div class="language-cmake" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">file</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(GLOB_RECURSE/GLOB  &lt;变量名&gt;  op(可选项):[CONFIGURE_DEPENDS] &lt;expr-</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;)</span></span></code></pre></div><p>是一个用来匹配指定路径下所有符合通配符条件的文件的命令。 GLOB_RECURSE 是递归查找目录下的所有文件， GLOB 则只在指定文件下 CONFIGURE_DEPENDS 标记依赖 当文件夹下新增文件时cmake会重新编译添加进文件 expr-path 简单的正则表达式表示的路径 file() 命令则可以用来获取文件列表</p><p>file(GLOB_RECURSE SOURCES src/<em>.cpp include/</em>.h) 递归地查找 src 和 include 目录下所有以 .cpp 或 .h 结尾的文件，并将它们存储在 SOURCES 变量中。然后，add_executable 命令使用 SOURCES 变量中的文件来生成可执行文件</p><h3 id="构建目标" tabindex="-1"><a class="header-anchor" href="#构建目标"><span>构建目标</span></a></h3><p>add_executable(target_name files...) add_add_executable和add_library 能直接参数后跟文件列表表示该目标依赖文件(编译的文件) 项目变大了文件散布在子文件夹写一堆文件 早期解决办法 1.include命令直接包含子文件夹的CMAKElist.txt 在子文件夹中使用list命令将文件路径打包成变量 2.file(GLOB_RECURSE src ...) 列举文件 3.set(FILEPATH ...) 手写文件 4.aux_source_directory(.cpp)</p><div class="language-cmake line-numbers-mode" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root cmakelists.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">include</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(A/cmakelists.txt)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">incldue(B/cmakelists.txt)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_executable</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(target_name </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${filepath}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">子目录A cmakelist.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">list</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(APPEND filepath</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/a.cpp</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${CMAKE_CURRENT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/b.cpp</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在有更现代的方法</p><p>target_sources 添加源码 其中参数路径可以使用生成器表达式</p><div class="language-cmake line-numbers-mode" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">签名</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">target_sources</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&lt;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">target</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  [&lt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">INTERFACE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PUBLIC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PRIVATE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   [FILE_SET &lt;set&gt; [</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">TYPE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> &lt;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">type</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&gt;] [BASE_DIRS &lt;dirs&gt;...] [FILES &lt;files&gt;...]]...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  ]...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">target_sources</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(taget_name</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PRIVATE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PUBLIC</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">INTERFACE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&lt;impl_file&gt;  myfunc.cpp  </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#实现文件 默认在CMAKE_CURRENT_SOURCE_DIR下</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">FILE_SET &lt;file_set_name&gt; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 文件集名称 你叫TYPE类型里的名称就可以省略TYPE</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">TYPE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  [HEADERS|CXX_MODULES]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">BASE_DIR &lt;dir&gt;     </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#要包含文件跟目录 一般是include 不写就相当于当前源码路径</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">FILES  &lt;filepath&gt; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#要包含的具体文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">... //能写好几个</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>tips 参考<a href="https://cmake.org/cmake/help/latest/command/target_sources.html#file-sets" target="_blank" rel="noopener noreferrer">文档</a></p><blockquote><p>Files in a PRIVATE or PUBLIC file set are marked as source files for the purposes of IDE integration</p></blockquote><p>被标记为源的.h文件可以被IDE找到防止IDE爆红找不到头文件</p><p>PRIVATE 告诉目标编译源文件 也就是编译时带上这些文件 HEADER_SETS INTERFACE 给head_only库用 -&gt; 把文件集合(引用的文件) 放 INTERFACE_HEADER_SETS变量里 PUBLIC target_sources里用的少 表示PRIVATE加INTERFACE</p><p>引入target是为了跟踪 The artifact kind (executable, library, header collection, etc)</p><p>Source files</p><p>Include directories</p><p>Output name of an executable or library</p><p>Dependencies</p><p>Compiler and linker flags</p><p>例子</p><div class="language-cmake" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">target_link_libraries</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(Tutorial</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  PRIVATE</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    MathFunctions</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre></div><p>note:</p><blockquote><p>The order here is only loosely relevant. That we call target_link_libraries() prior to defining MathFunctions with add_library() doesn&#39;t matter to CMake. We are recording that Tutorial has a dependency on something named MathFunctions, but what MathFunctions means isn&#39;t resolved at this stage. The only target which needs to be defined when calling a CMake command like target_sources() or target_link_libraries() is the target being modified. 调用target_link_libraries前只需要Tutorial的定义即可MathFunctions定义无所谓 add_library(MathFunctions)在前在后无关紧要</p></blockquote><h3 id="add-subdirectory" tabindex="-1"><a class="header-anchor" href="#add-subdirectory"><span>add_subdirectory</span></a></h3><p>集成子项目的cmakelists note: cmake处理子项目的子项目的cmakelists时 相对路径都是基于子项目的而不是包含他的上一级cmakelist</p><h3 id="引入第三方静态库" tabindex="-1"><a class="header-anchor" href="#引入第三方静态库"><span>引入第三方静态库</span></a></h3><p>以spdlog为例子 此类库基本为头文件库体积不打使用子模块构建</p><div class="language-powershell" data-ext="powershell" data-title="powershell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">git submodule add </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">仓库地址 注意仓库的分支默认是拉取默认分支</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">git submodule add </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">b </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">branch</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">repository</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  选择分支拉取</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">git submodule add git</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">github.com</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">:gabime</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">spdlog.git</span></span></code></pre></div><div class="language-cmake" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_subdirectory</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(spdlog) </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#添加子项目 相对当前cmakelist所在文件夹的相对路径</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">include_directories</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(spdlog/include/spdlog) </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#包含头文件</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_executable</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(hello main.cpp )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">target_link_libraries</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(hello spdlog) 链接库</span></span></code></pre></div><p>find_libary</p><p>应用于单纯的二进制包，没有配置文件，或者本地项目构建出的库.以下以本地构建的库为例</p><div class="vp-file-tree"><ul><li class="file-tree-item expanded"><!--[--><span class="tree-node folder"><!----><span class="name">helloproject</span></span><ul><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">build</span><span class="comment"><br> -...省略</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">src</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">demo1.cpp</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><span class="name">...</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">lib</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">mylib.dll(构建后生成)</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">mylib</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">build</span><span class="comment"> -...构建文件(省略)</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">mylib.h</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">mylib.cpp</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">CmakeLists.txt</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">CmakeLists.txt</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">CmakePresets.json</span></span><!--]--><!----></li><li class="file-tree-item"><!--[--><span class="tree-node file"><!----><span class="name">hello.cpp</span></span><!--]--><!----></li></ul><!--]--><!----></li></ul></div><p>在路径helloproject/lib/CmakeLists.txt 中</p><div class="language-cmake" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#设置库路径</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#指定库生成路径</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_ARCHIVE_OUTPUT_DIRECTORY</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ${PROJECT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/lib)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_LIBRARY_OUTPUT_DIRECTORY</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ${PROJECT_SOURCE_DIR}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/lib)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(LIB_SRC </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${PROJECT}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/lib/mylib.cpp)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#生成dll</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">add_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(testshared SHARED </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${LIB_SRC}</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#生成库的名字(也可以指定其他属性)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set_target_properties</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(testshared PROPERTIES </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">OUTPUT_NAME</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> &quot;test&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre></div><p>在路径helloproject/lib/build/中 执行命令构建目标库</p><div class="language-powershell" data-ext="powershell" data-title="powershell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cmake .</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">.</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">G</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Ninja</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">  //</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">生成构建系统 最好指定使用toolchain.cmake配置指定编译器而不是让cmake寻找编译器可能会找到意料之外编译器或版本</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cmake </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">--</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">.</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">  //</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">单个库通常不需要指定目标</span></span></code></pre></div><p>在路径helloproject/CmakeLists.txt 中</p><div class="language-cmake line-numbers-mode" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">···</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#include_directories(${CMAKE_SOURCE_DIR}/mylib/) #指定头文件搜索路径</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(test_path </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NAMES</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> test</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./lib)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;库全路径为 ${test_path}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          &lt;VAR&gt;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">          name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> | </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NAMES</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> name1 [name2 ...] [NAMES_PER_DIR]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [HINTS [</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> | ENV var]...]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">path</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> | ENV var]...]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [REGISTRY_VIEW (64|32|64_32|32_64|HOST|</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">TARGET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|BOTH)]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [PATH_SUFFIXES suffix1 [suffix2 ...]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [VALIDATOR function]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DOC</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> &quot;cache documentation string&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_CACHE]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [REQUIRED]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_DEFAULT_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_PACKAGE_ROOT_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_CMAKE_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_CMAKE_ENVIRONMENT_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_SYSTEM_ENVIRONMENT_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_CMAKE_SYSTEM_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [NO_CMAKE_INSTALL_PREFIX]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">          [CMAKE_FIND_ROOT_PATH_BOTH |</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">           ONLY_CMAKE_FIND_ROOT_PATH |</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">           NO_CMAKE_FIND_ROOT_PATH]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">         )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>&lt;VAR&gt; :首个参数指定查找结果作为变量 (库的全路径包括后缀) 上述命令中为 test_path 当库未被找到，&lt;var&gt;中存放的值为<code>\&lt;var\&gt;-NOTFOUND</code>。 NO_CACHE 项 只要&lt;var&gt;中的值不是<code>\&lt;var\&gt;-NOTFOUND</code>(或有值)，那么即使多次调用find_library，&lt;var&gt;也不会再刷新(只要找到一个&lt;var&gt;，后续每次执行cmake命令得到的&lt;var&gt;都是首次找到的&lt;var&gt;值（除非清除CMakeCache.txt文件)。该选项将&lt;var&gt;变量当成一个普通变量而不是一个缓存条目，需要cmake 3.21及以上的版本支持(理解为全局变量，且会写入CMakeCache.txt文件，在不清除CMakeCache.txt文件的情况下，每次执行cmake都会先从CMakeCache.txt载入该变量的值)</p></div><div class="language-cmake line-numbers-mode" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">//例</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">make_minimum_required (</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">VERSION</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 3.21)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">project</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (fl)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (libvar mymath </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./mylib NO_CACHE)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (libvar mymath </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./lib NO_CACHE) </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 即使./lib中也存在mymath库，由于在上一步的./mylib中已经找到，因此本条命令不会执行查找</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${libvar}</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> STREQUAL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> &quot;libvar-NOTFOUND&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (FATAL_ERROR </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;required mymath library but not found!&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">else</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;mymath library found in ${libvar}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">endif</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">//例</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">make_minimum_required (</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">VERSION</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 3.21)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">project</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (fl)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (libvar mymath </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./mylib) </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># libvar是缓存条目，会存入`CMakeCache.txt`，后续即使把PATHS ./mylib改成PATHS ./mylib2（不存在库mymath），也不会保存，因为libvar变量已经从缓存中载入</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${libvar}</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> STREQUAL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> &quot;libvar-NOTFOUND&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (FATAL_ERROR </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;required mymath library but not found!&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">else</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;mymath library found in ${libvar}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">endif</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>NAMES或name: 指定一个或多个库的名字 上述命令中为 NAMES test</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>[PATHS [path | ENV var]...]或[HINTS [path | ENV var]...]: 可选项 指定搜索库的路径 上述命令中为 PATHS ./lib 同时可以指定环境变量 <code>find_library (libvar mymath PATHS ENV TESTPATH)</code> 指定环境变量TESTPATH 为查找路径 假设环境变量被设置为./lib</p></div><p>REQUIRED：指定该选项后，当找不到库，会输出一条错误信息并终止cmake处理过程；未指定REQUIRED选项，当find_library未找到库时，后续find_library有针对&lt;var&gt;的调用会继续查找。该选项需要cmake 3.18及以上的版本支持</p><p>PATH_SUFFIXES：为每个搜索目录添加变量PATH_SUFFIXES指定的后缀目录，假设当前搜索的目录为/A;/C/D，PATH_SUFFIXES指定的后缀目录为PS(当前可以指定多个，以分号分割开即可)，那么除了/A;/C/D之外，/A/PS;/C/D/PS也会被搜索</p><div class="language-cmake" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (libvar mymath </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./ PATH_SUFFIXES mylib) </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 会从./以及./mylib中搜索指定的mymath库是否存在</span></span></code></pre></div><p>CMAKE_FIND_ROOT_PATH：指定搜索的根路径</p><p>CMAKE_SYSROOT：该选项的值会传递给编译器的--sysroot标记(--sysroot用于指定编译搜索库和头文件的根目的，例如编译器原本搜搜索/A/include和/A/lib，使用--sysroot=DIR后，编译器搜索的库和头文件目录变成/DIR/A/include和/DIR/A/lib) NO_DEFAULT_PATH:如果指定了，默认搜索路径不会生效 默认搜索路径:CMAKE_LIBRARY_ARCHITECTURE、CMAKE_PREFIX_PATH、CMAKE_LIBRARY_PATH、CMAKE_FRAMEWORK_PATH 指定的路径或 系统环境变量（例如系统环境变量LIB和PATH定义的路径）、系统的默认的库安装路径,例如/usr、/usr/lib等</p><div class="vp-steps"><p>1.先找包路径&lt;PackageName&gt;_ROOT(NO_PACKAGE_ROOT_PATH 或CMAKE_FIND_USE_PACKAGE_ROOT_PATH 为 FALSE则跳过) &lt;CurrentPackage&gt;_ROOT, ENV{&lt;CurrentPackage&gt;_ROOT}, &lt;ParentPackage&gt;_ROOT, ENV{&lt;ParentPackage&gt;_ROOT} 2.cmake缓存变量，即命令行中 -D &lt;VAR&gt;=value 设置的变量 例如<code>cmake . -DCMAKE_XXX_PATH=D:xxx\xxx</code> (NO_CMAKE_PATH 如果设置了此项或CMAKE_FIND_USE_CMAKE_PATH 为 FALSE 则跳过) other 3.cmake指定的环境变量 CMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH (设置此项为FALSE或NO_CMAKE_ENVIRONMENT_PATH 跳过此过程) other 4.HINT 指定的路径 HINT使用系统内计算的软路径，相对路径 ,PATH指定硬编码的路径 5.编译环境的系统环境变量(例如系统环境变量LIB和PATH定义的路径) (NO_SYSTEM_ENVIRONMENT_PATH或CMAKE_FIND_USE_SYSTEM_ENVIRONMENT_PATH 为FALSE 时跳过) 6.当前系统平台中相关的cmake变量(系统的默认的库安装路径) (CMAKE_INSTALL_PREFIX 和 CMAKE_STAGING_PREFIX) NO_CMAKE_SYSTEM_PATH或 CMAKE_FIND_USE_CMAKE_SYSTEM_PATH 为 FALSE 可以跳过所有这些路径搜索 other(关联路径替换为 CMAKE_SYSTEM_PREFIX_PATH 默认前缀 Windows下的/XXXX/Program Files，Linux下的/usr或/usr/local 查找时替换为/XXXX/Program Files/lib , /usr/local/lib进行搜索 CMAKE_SYSTEM_LIBRARY_PATH 默认是当前系统的标准目录</p><p>CMAKE_SYSTEM_FRAMEWORK_PATH 给macOS用，其框架路径 ) 通常是已安装的软件的位置，比如Linux下软件安装到/usr/local</p><p>7.PATHS指定路径 或 简短版本 find_library (&lt;VAR&gt; name1 [path1 path2 ...])中的的路径path1,path2...</p><p>指定如下这些变量也能忽略上述查找 CMAKE_IGNORE_PATH, CMAKE_IGNORE_PREFIX_PATH, CMAKE_SYSTEM_IGNORE_PATH and CMAKE_SYSTEM_IGNORE_PREFIX_PATH</p><p>other： &lt;prefix&gt;/lib/&lt;arch&gt; CMAKE_LIBRARY_ARCHITECTURE 如果该变量被设置，那么会搜索目录<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>C</mi><mi>M</mi><mi>A</mi><mi>K</mi><msub><mi>E</mi><mi>P</mi></msub><mi>R</mi><mi>E</mi><mi>F</mi><mi>I</mi><msub><mi>X</mi><mi>P</mi></msub><mi>A</mi><mi>T</mi><mi>H</mi></mrow><mi mathvariant="normal">/</mi><mi>l</mi><mi>i</mi><mi>b</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">{CMAKE_PREFIX_PATH}/lib/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">CM</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">REF</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ib</span><span class="mord">/</span></span></span></span>{CMAKE_LIBRARY_ARCHITECTURE} CMAKE_PREFIX_PATH 多个前缀以分号分隔 比如 CMAKE_PREFIX_PATH=A;B 那么会为${CMAKE_PREFIX_PATH}/lib 即 A/lib ,B/lib中查找库 CMAKE_LIBRARY_PATH 指定find_library的库查找目录，默认值为空，多个值时需要以分号分割列表指定</p><p>CMAKE_FRAMEWORK_PATH 给macOS 用的 &lt;prefix&gt;/lib/</p></div><p>默认搜索路径需要涵盖最常用和最不常用的情况，通常 使用NO前缀项忽略 find_library (&lt;VAR&gt; NAMES name PATHS paths... NO_DEFAULT_PATH) find_library (&lt;VAR&gt; NAMES name) NAMES 指定多个名字时，默认每个路径都搜索一遍该名字 (一个名字在多个文件夹搜索) NAMES_PER_DIR 选项 指定一次考虑一个文件夹(路径)每次搜索所有名字 (多个名字在一个文件夹检索) 查找库名字时先原样查找 给什么查什么 比如 <code>find_library (lib NAMES mylib PATHS &quot;D:\xxx\xxx&quot; NO_DEFAULT_PATH)</code> 那么先查找<code>mylib</code> 某些平台规定的前后缀(例如.lib或.so)由 CMAKE_FIND_LIBRARY_PREFIXES 和CMAKE_FIND_LIBRARY_SUFFIXES 变量指定 。当然也可以直接写明后缀。如mylib.a(unix) mylib.lib(win)</p><p>如果目标库是框架 &lt;VAR&gt;变量存储目标库的全路径 &lt;fullPath&gt;/A.framework,当框架被当作库使用时 使用-framework A, 和 -F&lt;fullPath&gt; 链接框架到目标</p><p>如果指定了自定义搜索路径前缀 CMAKE_FIND_LIBRARY_CUSTOM_LIB_SUFFIX 那么搜索时的 前缀路径lib/ 会替换为 ${CMAKE_FIND_LIBRARY_CUSTOM_LIB_SUFFIX}/(同样存lib32,libx32,lib64 版本) project()命令启动时如果设置了至少一种语言 那么会自动设置此类变量</p><p>FIND_LIBRARY_USE_LIB32_PATHS(同样存lib32,libx32,lib64 版本) 在搜索路径中匹配到lib/后，会为这个目录添加一个后缀，然后在添加后缀后的目录中搜索库</p><div class="language-cmake line-numbers-mode" data-ext="cmake" data-title="cmake"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">cmake_minimum_required</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">VERSION</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 3.21)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">project</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (fl)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">find_library</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (libvar mymath </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">PATHS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ./lib) </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 假设lib目录不存在但是lib64目录存在</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">${libvar}</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> STREQUAL</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> &quot;libvar-NOTFOUND&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (FATAL_ERROR </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;required mymath library but not found!&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">else</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    message</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (STATUS </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;mymath library found in ${libvar}&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">endif</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">// 命令行中执行</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cmake .</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">// 执行结果</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">-- mymath library found in /XXX/lib64/libmymath.a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cmake的构建命令" tabindex="-1"><a class="header-anchor" href="#cmake的构建命令"><span>cmake的构建命令</span></a></h3><p>如果你使用 cmake --build 而不是直接调用更底层的构建系统（译者注：比如直接使用 make），你可以用 -v 参数在构建时获得详细的输出（CMake 3.14+），用 -j N 指定用 N 个 CPU 核心并行构建项目（CMake 3.12+），以及用 --target（任意版本的 CMake）或 -t（CMake 3.15+）来选择一个目标进行部分地构建。这些命令因不同的构建系统而异，例如 VERBOSE=1 make 和 ninja -v。你也可以使用环境变量替代它们，例如 CMAKE_BUILD_PARALLEL_LEVEL (CMake 3.12+) 和 VERBOSE (CMake 3.14+)。</p><h3 id="cmake-add-custom-command-命令" tabindex="-1"><a class="header-anchor" href="#cmake-add-custom-command-命令"><span>cmake add_custom_command 命令</span></a></h3><p>还有一个相关的函数 <code>add_custtom_target</code> add_custom_command 有一些典型用法 见cmake文档里的<a href="https://cmake.org/cmake/help/latest/command/add_custom_command.html#examples-generating-files" target="_blank" rel="noopener noreferrer">链接</a> 典型用法 1.构建动态库前使用代码生成工具生成源文件参与构建 2.在构建事件后执行复制dll到可执行文件夹下，或在构建后执行清理操作</p><p>函数原型就不列出了 之说几个重要的参数 第一个重载 :生成文件 第二个重载:构建事件</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT output1 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">output2 ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                   COMMAND command1 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ARGS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">args1...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                   ...</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">其他参数</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                   )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TARGET </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">target</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                   PRE_BUILD </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> PRE_LINK </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> POST_BUILD</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                   COMMAND command1 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ARGS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">args1...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                   ...</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">其他参数</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                   )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OUTPUT 指定生成的文件创建在和当前cmakelist同一路径中 只要没有这些文件就会执行命令</p><p>COMMAND 后跟实际需要执行的执行，一般是命令行指令，也可以是可执行文件,python命令，自定义脚本凡是能在命令行执行的都能在这里设置</p><p>DEPENDS 指定依赖项 当依赖项变动时会执行命令。时间戳</p><blockquote><p>If DEPENDS is not specified, the command will run whenever the OUTPUT is missing 不指定DEPENDS 那么OUTPUT缺失每次都会执行</p></blockquote><p>graph LR D[DEPENDS 指定的目标/文件] --&gt; C[自定义命令] C --&gt; O[OUTPUT 生成的文件]</p><p>依赖项除了文件还能是由add_custom_target 或 add_library/add_executable 创建的目标。</p><p>如果依赖了 目标target 那么此命令会在任何依赖的目标生成前执行。这建立了一个执行命令/生成文件-&gt;构建目标的依赖关系</p><p>可执行文件或库 则建立文件级别依赖。那么只要重新编译了那么就会执行改命令</p><p>已经添加到生成目标的源文件 如<code>add_executable(cmakestudy main.cpp )</code> 里的main.cpp 也会建立文件级别依赖</p><p>依赖绝对路径和相对路径的化也会建立文件级别依赖</p><p>如果未指定DEPENDS,则命令将在OUTPUT缺失时运行；如果命令实际上没有创建 OUTPUT, 则规则将始终运行</p><p>BYPRODUCTS 非主要构建产物(副产品) ninja明确支持</p><blockquote><p>Specify the files the command is expected to produce but whose modification time may or may not be newer than the dependencies. 指定生成的文件可能会比依赖项更新，或者不更新。这个解释好拗口，大致意思是，这是副产品有时候生成有时候不生成，这时候依赖副产品的构建可能就会出问题,你指定了这是副产品，那么Ninja生成器就能处理正确依赖，在你不能保证生成最新的文件时候依然能构建。</p></blockquote><p>COMMENT 在构建时在执行命令之前输出注释</p><p>VERBATIM 告诉cmake 执行的命令的参数不要转义，原样传递给命令</p><p>WORKING_DIRECTORY 执行命令前会从cd到该参数指定的路径下</p><p>第二个重载</p><p>TARGET 依赖的目标 依赖目标变动(该命令会被当做目标构建的一部分)才会执行,换句话说只有目标被构建的时候才会执行,如果目标源文件不变 <code>cmake --build . --target hello</code> 这个命令执行第一次会执行一次命令。再次生成目标，因为源代码没变不需要重新构建所以该命令不会执行。</p><p>PRE_BUILD | PRE_LINK | POST_BUILD 命令执行的时机 构建前 链接前 构建后</p><blockquote><p>This option has unique behavior for the Visual Studio Generators. When using one of the Visual Studio generators, the command will run before any other rules are executed within the target. With all other generators, this option behaves the same as PRE_LINK instead. Because of this, it is recommended to avoid using PRE_BUILD except when it is known that a Visual Studio generator is being used 这里单独解释了 PRE_BUILD 对于vs生成器来说,使用此参数会在任意构建行为前执行，对其他生成器,PRE_BUILD和PRE_LINK效果一样,别生成器可能不支持此参数,我用Ninja是这样的</p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    TARGET</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> hello</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    PRE_BUILD</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -E</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">This is a pre-build command for hello target</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMENT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Pre-build command for hello target</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">proc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> 正在执行命令:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> D:...</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">make</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\b</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">in</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\c</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">make.EXE</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --build</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> C:.../deve_env/build/clang-msvc-clangd-debug</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --target</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> hello</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1/5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> generate_time-alawys</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">2/5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Generating output files-DEPENDS</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">3/5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Generating CXX dyndep file CMakeFiles/hello.dir/CXX.dd</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">4/4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Linking CXX executable C:...deve_env</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\o</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ut</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\h</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ello.exe</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> This is a pre-build command </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> hello target</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">driver</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 生成完毕: 00:00:02.193</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 生成已完成，退出代码为 0</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">//换成PRE_LINK</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">proc</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 正在执行命令: D:..</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">make</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\b</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">in</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\c</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">make.EXE --build C:.../deve_env/build/clang-msvc-clangd-debug --target hello --</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1/5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> generate_time-alawys</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">2/5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Generating output files-DEPENDS</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">3/5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Generating CXX dyndep file CMakeFiles/hello.dir/CXX.dd</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">4/4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Linking CXX executable C:...</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\d</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">eve_env</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\o</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ut</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\h</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ello.exe</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> This is a pre-link command </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> hello target</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">driver</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 生成完毕: 00:00:01.963</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 生成已完成，退出代码为 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很奇怪的是这里COMMENT没打印出来,而且echo消息都是在链接后打印出来的,可能Ninja编译期都不支持此参数？这个需要查一下文档</p><p>这个重载用法基本上就是 构建后复制、签名、打包</p><p>用的少的参数 APPEND 在COMMAND后添加命令 注意COMMAND 可以加很多行 对同一文件多次处理 时使用多个add_custom_command 时存在一个命令链 没用过</p><p>USES_TERMINAL 指定使用的终端 和APPEND 不能一起使用。对于Ninja生成器这会把命令放在console pool中(因为ninja可以并发构建)</p><p>JOB_POOL 任务池 Ninja专用的</p><p>JOB_SERVER_AWARE 给makefile用的 没去了解</p><p>例子</p><div class="language-c" data-ext="c" data-title="c"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    TARGET cmakestudy</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    PRE_LINK</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMAND $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">E echo </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">testfile2</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\n</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> output2.txt</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMENT </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test for pre_link output file2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    WORKING_DIRECTORY $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre></div><p>关于这个命令我搜到一个<a href="https://discourse.cmake.org/t/define-a-pre-build-command-without-creating-a-new-target/1623/3" target="_blank" rel="noopener noreferrer">问题</a> 利用</p><blockquote><p>If <code>DEPENDS</code> is not specified, the command will run whenever the <code>OUTPUT</code> is missing; if the command does not actually create the OUTPUT, the rule will always run.</p></blockquote><p>OUTPUT 指定一个虚拟文件,实际命令中不生成他,以此来每次构建时都执行该命令</p><div class="language-" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>add_custom_command(OUTPUT &quot;foo&quot; &quot;${VisualT_BINARY_DIR}/src/buildDate.h&quot;</span></span>
<span class="line"><span>                   COMMAND ${CMAKE_COMMAND} -P &quot;${VisualT_BINARY_DIR}/cmake/ConfigureBuildDate.cmake&quot;</span></span>
<span class="line"><span>                   COMMENT &quot;generating build date header&quot;</span></span>
<span class="line"><span>                   )</span></span>
<span class="line"><span>add_library(VisualT_library SHARED &quot;${private_headers}&quot; &quot;${public_headers}&quot; &quot;${sources}&quot;) #buildDate.h is contained in &quot;private_headers&quot;</span></span></code></pre></div><p>这里不生产foo 让每次构建VisualT_library 时都执行ConfigureBuildDate脚本 实际确实有时候执行有时候不执行。有时候执行两次 这个问题和Makefile相关 <a href="https://gitlab.kitware.com/cmake/cmake/-/issues/21061" target="_blank" rel="noopener noreferrer">解决方案</a></p><p>在学习此命令时,我问了deepseek：add_custom_command 什么时候才会执行 他告诉我三种情况 1.OUTPUT 生成的文件不存在时 2.DEPENDS 中依赖的文件比OUTPUT文件更新时 3.其他命令或目标依赖此OUTPUT时</p><p>例一 一开始我写一个规则</p><div class="language-c" data-ext="c" data-title="c"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    OUTPUT $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMAND $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">P echo </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hello</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    WORKING_DIRECTORY $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMENT </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files-DEPENDS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre></div><p>然后没有指定任何依赖,配置后点击生成,构建时COMMENT没打印，也没文件生成,后来我才明白要让生成文件参与目标的构建，被构建目标依赖命令才会执行。按照cmake文档的实例,文档中依靠工具生成模板.c文件然后添加到构建目标的依赖中,在构建目标生成之前,该命令会执行。</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_executable</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hello main.cpp $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">})</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_library</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">lib xx.cpp $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">})</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//这样不行,添加依赖只能添加目标的依赖而不能是文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_dependencies</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hello $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">})</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//但是自定义创建一个目标再令其依赖${OUTPUT2}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_target</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    test1</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    DEPENDS $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    WORKING_DIRECTORY $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMENT </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generate_time2-alawys</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//再令该目标与生成的目标建立依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_dependencies</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hello </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">test1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//或手动构建该目标</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cmake </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">build. </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">--</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">target test1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>都可以执行生成${OUTPUT2}的命令 注意需要在构建目标的过程中形成依赖,我一开始的错误是即使没有将依赖连接到构建目标上,所以命令根本不会执行</p><p>例2 这个例子是我当初想要试试<code>add_custom_command</code> 是否真的依赖DEPENDS 声明的文件或目标;根据依赖比OUTPUT生成文件要新从而生成文件,我写了如下测试</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT1 $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">log.txt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2 $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">log2.txt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    OUTPUT $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMAND echo </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">This is a custom command that generates output files</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    WORKING_DIRECTORY $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMENT </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    OUTPUT $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMAND echo </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">This is a custom command that generates output files</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    BYPRODUCTS $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    WORKING_DIRECTORY $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMENT </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_executable</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hello main.cpp $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我很快就发现了问题,${OUTPUT1}每次生成的内容都是一样的,所以依赖项不会更新,即使修改源码重新构建也只会执行配置后开始的第一次。 注意Ninja是增量构建，如果文件没有变动反复生成同一目标实际是不会构建的只会报 [build] ninja: no work to do.</p><p>所以我寄希望与生成当前时间写入文件中(这样就不需要我每次都手动改动文件来观测了),我的期望是每次生成时写入新的当前时间到<code>${OUTPUT1}</code>,因为生成<code>${OUTPUT2}</code>依赖<code>${OUTPUT1}</code>,所以命令 Generating output files2 总会执行。 我新增如下测试</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//新增和修改部分,其他地方和之前一致</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">string</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">TIMESTAMP TIME_NOW </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">%</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">m-</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">-</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">%</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">H:</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">%</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">M:</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%S</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">message</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">STATUS </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">当前时间: ${TIME_NOW}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    OUTPUT $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMAND echo </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">This is time is${TIME_NOW}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    WORKING_DIRECTORY $</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    COMMENT </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该测试也只是在第一次配置后执行，之后就不执行了。 分析一下 目标hello依赖 <code>${OUTPUT2}</code>,<code>${OUTPUT2}</code>依赖<code>${OUTPUT1}</code></p><p><code>${OUTPUT1}-&gt;${OUTPUT2}-&gt;hello</code> 很明显OUTPUT1是没有依赖的,所以生成后只要该文件不删除那么就不会执行,所以OUTPUT2也不会执行。 随机我使用add_custom_target,以为目标默认都不是最新的所以每次都会执行构建行为</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">string(TIMESTAMP</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TIME_NOW</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%m-%d-%H:%M:%S</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/log.txt</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/log2.txt</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">message(STATUS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">当前时间: </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">TIME_NOW</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_target(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    alawys_run</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMAND</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">This is time is</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">TIME_NOW</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    BYPRODUCTS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    WORKING_DIRECTORY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMENT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    OUTPUT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMAND</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">This is a custom command that generates output files</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    DEPENDS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    WORKING_DIRECTORY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMENT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files2</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_executable(hello</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main.cpp</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_dependencies(hello</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> alawys_run</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>让hello依赖alawys_run ,<code>${OUTPUT2}</code> 再依赖alawys_run的生成文件<code>${OUTPUT1}</code>。按道理,这两个命令都会执行的，但实际是只执行一次就歇菜了。这是为什么呢？我搞了好久才明白</p><div class="language-shell" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">string(TIMESTAMP</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TIME_NOW</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%m-%d-%H:%M:%S</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre></div><p>这里生成的时间戳是静态的,每次configure也就是 cmake --build ./build -G ninja -S.的时候就生成了,之后每次构建时间就是相同的，要想动态的只能使用脚本. 我在Windows上构建,Powershell脚本很简单</p><div class="language-shell" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#ps1</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$time</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> = Get-Date -Format </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">MM-dd-HH:mm:ss</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Add-Content</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -Path</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">log.txt</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -Value</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $time</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#cmake 脚本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">string(TIMESTAMP</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> now</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%m-%d-%H:%M:%S</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">file(APPEND</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> log2.txt</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">${</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">now</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">\n</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre></div><p>调用脚本才能动态生成时间。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/script/log.txt</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">set</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/script/log2.txt</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 强制每次都执行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_target(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    generate_time</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMAND</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> powershell</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -ExecutionPolicy</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Bypass</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -File</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./cr_time.ps1</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    #DEPENDS ${OUTPUT1}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    BYPRODUCTS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    WORKING_DIRECTORY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/script</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMENT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generate_time-alawys</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#上下两个脚本执行一个就行了</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_target(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    generate_time2</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    DEPENDS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    #DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/script/TEST.txt</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    WORKING_DIRECTORY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/script</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMENT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generate_time2-alawys</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_command(</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    OUTPUT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -P</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/script/cr_time_c.cmake</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    DEPENDS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">OUTPUT1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    WORKING_DIRECTORY</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ${</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CMAKE_CURRENT_SOURCE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/script</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    COMMENT</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generating output files-DEPENDS</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    VERBATIM</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_executable(hello</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main.cpp</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#这里选择执行哪个就添加哪个做依赖</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_dependencies(hello</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> generate_time</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> generate_time2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="add-custom-target" tabindex="-1"><a class="header-anchor" href="#add-custom-target"><span>add_custom_target</span></a></h3><p>首先声明一点 现代cmake构建是以target(目标)来构建代码的 ,创建目标避免声明式的全局依赖 之前都是用类似<code>include_directories</code>，<code>link_directories</code> 这种命令这种命令是全局在子项目头文件和链接库也会包含进来 为了更好更模块化的项目管理构建 使用面向目标的命令 <code>add_custom_target</code> 正是有别于 <code>add_library</code>和<code>add_executable</code> 创建一个自定义目标 这个目标不一定需要生成目标,通常执行一些外部脚本,例如编写c++程序需要一些前置文件,由python脚本或其他语言的现有程序生成,那么以此创建一个目标来执行命令更加符合现代cmake的用法 首先熟悉一下该命令的参数</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">add_custom_target(Name</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [ALL] </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">command1 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">args1...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">COMMAND command2 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">args2...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">DEPENDS depend depend depend ...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">BYPRODUCTS </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">files...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">WORKING_DIRECTORY dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">COMMENT comment</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">JOB_POOL job_pool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">JOB_SERVER_AWARE </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bool</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">VERBATIM</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">USES_TERMINAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">COMMAND_EXPAND_LISTS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SOURCES src1 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">src2...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]]</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Name 不必多说 目标的名字</p><p>ALL 用来指示是否作为默认构建的目标 当我们执行<code>cmake --build .</code> 而不在最后指定目标时 指示这个会在我们构建全部目标时把此目标加入构建 后面的 可以跟命令 但这是隐式的行为 一般使用 COMMAND声明 后写命令</p><p>COMMAND 传入的命令 多个命令按顺序执行 但不构成有状态的偏序 也就说 假如 命令1:创建文本1-&gt;命令2:读取文本1创建文本2-&gt;命令3:读取文本2创建文本3 这种有状态的脚本cmake command干不了;要执行完整的的脚本需使用<code>configure_file()</code>或<code>file(GENERATE)</code> 该命令同时可以把其他<code>add_executable</code> 创建的目标作为参数 也就说可以先生成其他可执行文件,再执行作为此次构建的依赖 (但要保证目标不是交叉编译的产物--废话！有例外但不用关注) COMMAND 的参数可以使用 生存器表达式</p><p>TARGET_FILE</p><p>TARGET_LINKER_FILE</p><p>TARGET_SONAME_FILE</p><p>TARGET_PDB_FILE</p><p>使用这些作为生成器表达式时会生成依赖链,保证用到的时候生成</p><p>BYPRODUCTS 命令执行的副产物 命令不一定每一次执行都生成一个一定的文件所以叫副产物,有时生成有时不生成.这玩意可以提供依赖无论是 <code>add_custom_target</code> 还是 <code>add_custon_command add_dependencies</code> 用此声明的名字 都可以作为这些命令的DEPENDS 的依赖项 cmake文档说明ninja 明确支持BYPRODUCTS 这个参数的 ninja编译器会在 副产物缺失时生成(存在的时根据命令是否更新) 以保证 构建依赖项存在依赖 可以使用一些生成表达式 一些其他说明无关紧要必要时参考cmake文本</p><p>WORKING_DIRECTORY 命令执行时的路径 可以使用生成器表达式</p><p>COMMENT 构建时echo 命令行的提示信息 可以使用生成器表达式</p><p>DEPENDS 类似 add_custon_command页的介绍 也可以依赖 同一cmakelist 文件中 add_custom_command() 创建的OUTPUT的文件和依赖的文件项</p><p>COMMAND_EXPAND_LISTS 让 COMMAND 中的参数列表会展开 假如你传的是${MY_ARGS} 这样一个变量 这个变量包含多个参数 会当整个字符串都当一个参数传进去 展开什么效果我也没试试 <code>⚠</code></p><p>​​SOURCES​ 指定该目标的源文件 这些文件不会参与编译不影响构建 这是给VSCODE CLINO 这些IDE的插件看到你定义了这个目标就会在图形化界面里添加到该目标下面方便你编辑和管理</p><p>VERBATIM 转义的传入参数为了原样传入参数 也就说不用写 \a &quot; 这样的转义符cmake自动帮你转义</p><p>JOB_POOLS ninja这些多线程构建器会使用 和 USES_TERMINAL 不兼容 不深入构建不用过多关注 因为cmake需要兼容多个生成器所以有些参数不那么重要却要覆盖所有生成器</p><p>注意- 这里渲染一下 该命令是在执行 <code>cmake --build .</code> 也就是调用内部生成器构建编译代码时执行的 ,add_custom_target 在语义上 只有生成的副产品而没有生成文件,cmake文档明确说:就算生成和目标同名的文件都会当做过时的所以只要添加依赖,每次构建都会生成 所以用来生产时构建时日志</p><h3 id="生成器表达式" tabindex="-1"><a class="header-anchor" href="#生成器表达式"><span>生成器表达式</span></a></h3><p>用于在生成阶段而不是配置阶段生成数据,一般用来生成路径</p><h2 id="为项目添加依赖" tabindex="-1"><a class="header-anchor" href="#为项目添加依赖"><span>为项目添加依赖</span></a></h2><h3 id="find-package" tabindex="-1"><a class="header-anchor" href="#find-package"><span>find_package</span></a></h3><p>该指令有两种模式查找包 module 模式 该模式cmake通过搜索文件名格式为:Find&lt;PackageName&gt;.cmake的脚本文件,由该脚本来找包 在cmake安装路径 <code>\&lt;cmake_path\&gt;/share/cmake\&lt;version\&gt;/</code> 可以看到一些该格式的脚本 这些都是cmake维护一份查找常用软件包的脚本 当然这些脚本通常不是库提供者维护的可能会有些过时 同时也可以自主维护一个Find&lt;PackageName&gt;.cmake脚本</p><p>通常在调用find_package 的module模式之前 设置 CMAKE_MODULE_PATH 变量 为 Find&lt;PackageName&gt;.cmake的查找路径让cmake找到需要的脚本 其次会去cmake维护的路径搜索</p><p>config模式 这个推荐且比较常使用;除非特殊指定一般module模式查找失败是会使用该模式 通常在github下载包后,使用cmake构建完成.项目的&lt;packagename&gt;/lib/cmake/ 路径会存在 形如 &lt;PackageName&gt;Config.cmake或&lt;LowercasePackageName&gt;-config.cmake &lt;lowercasePackageName&gt;-config-version.cmake &lt;PackageName&gt;ConfigVersion.cmake的文件前两个比较常见,这些是由软件/包开发者同步维护的 cmake的config模式正是通过搜索该文件来查找引入软件包</p><p>同文件夹下可能还存在 &lt;PackageName&gt;ConfigVersion.cmake或&lt;LowercasePackageName&gt;-config-version.cmake 脚本用来指示包的版本并验证包版本是否满足查找要求 只要&lt;PackageName&gt;Config.cmake 被找到且版本满足要求那么包就被视为被找到 一个常用变量&lt;PackageName&gt;_FOUND被设置为true</p><p>tips 一个&lt;PackageName&gt;Config.cmake 可能包含多个导出的目标,这些目标可能是经过子模块构建的,然后通过cmake命令include() 包含该.cmake的脚本文件来引入目标</p><p>使用find_package 模式之前一般会设置 <code>CMAKE_PREFIX_PATH</code> 变量来引入包路径</p><p>假设存在一个包路径为./libs/A_package/lib/cmake/A_compent/A_packageConfig.cmake 那么就要把<code>CMAKE_PREFIX_PATH</code>设置为 ././libs/A_packag 同时也可以设置一个同名环境变量<code>CMAKE_PREFIX_PATH</code> 来指示包搜索路径</p><p>&lt;PackageName&gt;_DIR 也可以指示搜索路径不过这个路径要指示到./lib/cmakeA_compent/</p><p>find_package 的函数签名</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//典型用法</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PackageName\</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">version</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">REQUIRED</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">COMPONENTS </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">components</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">])</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//该签名只有PackageName是必要的</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//常见写法</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Catch2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">GTest REQUIRED</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Boost </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1.79</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> COMPONENTS date_time</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//基本签名 Basic Signature</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PackageName\</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">version</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">EXACT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">QUIET</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">MODULE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">             [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">REQUIRED</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OPTIONAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">COMPONENTS</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">] [</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">components</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">             [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OPTIONAL_COMPONENTS components...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [REGISTRY_VIEW  </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">64|32|64</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">_32</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|32</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">_64</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">HOST</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">TARGET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">|</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">BOTH</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [GLOBAL]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [NO_POLICY_SCOPE]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [BYPASS_PROVIDER]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [UNWIND_INCLUDE])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>介绍一下Basic Signature 被module和config模式同时支持 这两种模式找到包都会设置 一个 &lt;PackageName&gt;_FOUND 变量指示是否找到包</p><p>一些参数的用处 [QUIET] 禁用信息提示,REQUIRED的包找不到不会报错</p><p>[OPTIONAL] 指示的包是可选的找不到不报错</p><p>[REQUIRED] 指示的包是必要的 找不到包cmake会报错并停止配置</p><p>[[COMPONENTS] [components...]] COMPONENTS关键字后跟该包需要引入的组件名 例如Boost库下的regex asio等组件 任意一个组件找不到则整个包被视为找不到 tips REQUIRED/OPTIONAL后可以直接跟组件名而不用写COMPONENTS关键字 例如</p><div class="language-c++" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">absl REQUIRED strings flat_hash_map Time</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre></div><p>[version] 指示所查询的包版本 两种参数形式 1.major[.minor[.patch[.tweak]]] 2.versionMin...[&lt;]versionMax verMIn...verMax范围形式的两端都包含在内 用了<code>&lt;</code>符号排除端点</p><p>[EXACT] 该参数指示搜索包的版本和version完全相同 (和version的范围参数版本不兼容)</p><p>tips 注意[version] [EXACT]参数和[COMPONENTS]如果不设置会被外部调用的同参数继承 也就是说find_package指定了[version] [EXACT],[COMPONENTS]参数,所查找到.cmake脚本中再次调用find_package且没指定这三个参数,那么这个子调用也会应用这三个参数</p><p>tips 对于常见调用<code>find_package(Catch2)</code>不声明组件的调用 具体行为是找到所有组件,不找任何组件或任意个组件由config.cmake脚本来决定cmake不对这种用法做规定 <em>无关紧要的参数说明</em> [OPTIONAL_COMPONENTS components...] 由该参数指示的组件找不到无所谓,只要required的组件找到就表示该包被找到</p><p>[REGISTRY_VIEW] windows上有用 通过注册表查询</p><p>[GLOBAL] 将引入的组件提升到全局 CMAKE_FIND_PACKAGE_TARGETS_GLOBAL变量也能做这件事</p><p>[BYPASS_PROVIDER] 我也没弄懂干嘛的 [UNWIND_INCLUDE] 应用在find_package中调用find_package的情况;找不到包就相当于编程语言抛异常栈回溯一层层返回了,不让他继续find_package和include了 参考<a href="https://cmake.org/cmake/help/latest/command/install.html#command:install" target="_blank" rel="noopener noreferrer">install(EXPORT_PACKAGE_DEPENDENCIES)</a></p><p>除了基本签名还有一个完整签名的find_package 我省略了部分参数保留部分对我来说有用的解释一下</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">\</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PackageName\</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">version</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">EXACT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">QUIET</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">             [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">REQUIRED</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OPTIONAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">COMPONENTS</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">] [</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">components</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">             [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">|</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">NO_MODULE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             ...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [NAMES name1 [name2 ...]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [CONFIGS config1 [config2 ...]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [HINTS path1 [path2 ...]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [PATHS path1 [path2 ...]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             ...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             [PATH_SUFFIXES suffix1 [suffix2 ...]]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">             ...)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>[CONFIG|NO_MODULE] 这两是同义词 设置了这个就表示使用config模式 会跳过module模式的搜索过程</p><p>[NAMES] 包名的可选项 设置了此项 就不会查找&lt;PackageName&gt; 而是把names1...当包名查找</p><p>[CONFIGS] 该命令默认会找格式为&lt;PackageName&gt;Config.cmake 的脚本但是有时脚本名字不叫这一类 该参数允许你指定一类名字</p><p>搜索中所有被考虑的版本的脚本文件的路径放在 <code>\&lt;PackageName\&gt;_CONSIDERED_CONFIGS</code>变量里 对应的版本文件路径存在<code>\&lt;PackageName\&gt;_CONSIDERED_VERSIONS</code></p><p>[PATH_SUFFIXES] 为搜索路径指定后缀 指定后缀</p><p>config 模式查找顺序 首先不管什么模式都先在 CMAKE_FIND_PACKAGE_REDIRECTS_DIR 指示路径下查找 根据前缀路径和特定格式的路径查找 可能的前缀,查找顺序为: 1.找根路径 cmake 变量&lt;Pacakage_name&gt;_root Pacakge_name大小写都可</p><p>环境变量 &lt;Pacakage_name&gt;_root</p><p>tips 根路径会传递(按cmake文档所说包的根变量被被维护成一个栈)也就是说find_package查找的.cmake脚本中又调用了find_package那么这个子调用的查找路径会包含上一层父调用的。在调用find_package时手动传 NO_PACKAGE_ROOT_PATH 参数 或设置变量CMAKE_FIND_USE_PACKAGE_ROOT_PATH 为 FALSE来避免</p><p>2.将如下三个缓存变量做搜索前缀 在命令行中由 <code>-DVAR=VALUE</code>指定 CMAKE_PREFIX_PATH</p><p>CMAKE_FRAMEWORK_PATH</p><p>CMAKE_APPBUNDLE_PATH</p><p>调用时传参 NO_CMAKE_PATH或 设置CMAKE_FIND_USE_CMAKE_PATH 为FALSE 避免</p><p>3.以下特定环境变量 一般由shell指定的 &lt;PackageName&gt;_DIR</p><p>CMAKE_PREFIX_PATH</p><p>CMAKE_FRAMEWORK_PATH</p><p>CMAKE_APPBUNDLE_PATH</p><p>调用时传参 NO_CMAKE_ENVIRONMENT_PATH 或设置 CMAKE_FIND_USE_CMAKE_ENVIRONMENT_PATH 为 FALSE</p><p>4.HINTS</p><p>调用时传递参数 HINTS 一般由其他已存在的路径组合</p><p>5.操作系统的环境变量</p><p>传参 NO_SYSTEM_ENVIRONMENT_PATH 或 设置 CMAKE_FIND_USE_SYSTEM_ENVIRONMENT_PATH FALSE 跳过该步骤</p><p>6.用户注册表 windows系统用具体参考<a href="https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html#user-package-registry" target="_blank" rel="noopener noreferrer">文档</a></p><p>7.平台指定的cmake变量 cmake在不同平台会设置下面不同变量前缀 CMAKE_INSTALL_PREFIX / CMAKE_STAGING_PREFIX 通过调用时传递NO_CMAKE_INSTALL_PREFIX 或CMAKE_FIND_USE_INSTALL_PREFIX 设置为 FALSE 跳过这两个路径查询</p><p>CMAKE_SYSTEM_PREFIX_PATH</p><p>CMAKE_SYSTEM_FRAMEWORK_PATH</p><p>CMAKE_SYSTEM_APPBUNDLE_PATH</p><p>通过调用时传递 NO_CMAKE_SYSTEM_PATH 或设置 CMAKE_FIND_USE_CMAKE_SYSTEM_PATH 为 FALSE跳过上面这些路径的查询</p><p>tips linux软件可能安装在 /usr/local cmake就根据平台习惯把指定这些路径为此类变量</p><p>8.系统注册表 同样参考文档</p><p>9.调用时传递 PATHS 硬编码路径</p><p>tips 设置 CMAKE_IGNORE_PATH, CMAKE_IGNORE_PREFIX_PATH, CMAKE_SYSTEM_IGNORE_PATH 和CMAKE_SYSTEM_IGNORE_PREFIX_PATH 同样会导致上述路径被忽略</p><p>根据以上路径前缀+特定格式 组合成搜索路径 按顺序找到第一个可用的包就不会再找了 见<a href="https://cmake.org/cmake/help/latest/command/find_package.html#id21" target="_blank" rel="noopener noreferrer">文档表</a></p><p>例如 ./libs/absl/cmake/ ./libs/absl/lib/cmake/</p><p>对于存在多个版本包的配置文件搜索的规则的细致说明参考<a href="https://cmake.org/cmake/help/latest/command/find_package.html#command:find_package:~:text=For%20search%20paths%20which%20contain%20glob%20expressions" target="_blank" rel="noopener noreferrer">文档</a></p><p>以下变量也会影响到搜索的路径 CMAKE_FIND_ROOT_PATH 默认为空 会重定向find_package的搜索路径 CMAKE_SYSROOT 除了影响find_package的搜索结果还会影响别的一般不用</p><p>tips 搜索成功后会缓存变量;要清除构建文件 修改路径才能影响</p><p>以下三个变量会改变find_package包是否必要的行为 在find_package之前设置</p><p>CMAKE_DISABLE_FIND_PACKAGE_&lt;PackageName&gt; 不让该包被查找 1.模拟包找不到情况 2.该包内容包含在项目里</p><p>CMAKE_REQUIRE_FIND_PACKAGE_&lt;PackageName&gt; 让包称为必须的 该设置优先级高于find_package传参 OPTIONAL</p><p>常见写法</p><div class="language-c++ line-numbers-mode" data-ext="c++" data-title="c++"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">LIB_PATH </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">D:/workfile/lib</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    set</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CMAKE_PREFIX_PATH </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">${LIB_PATH}/abseil</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    find_package</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">absl REQUIRED strings flat_hash_map</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">absl_FOUND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        get_target_property</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">tmp </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">absl</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">::</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">strings INTERFACE_INCLUDE_DIRECTORIES</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        message</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">STATUS </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">absl::strings includes: ${tmp}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        //一般不用写</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">        #target_include_directories</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hello PRIVATE ${LIB_PATH}</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">abseil</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">include</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">absl</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        target_link_libraries</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">hello PRIVATE </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">absl</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">::</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">strings</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    else</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        message</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">FATAL_ERROR </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Could not find absl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    endif</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="fetchcontent" tabindex="-1"><a class="header-anchor" href="#fetchcontent"><span>FetchContent</span></a></h3><h3 id="install" tabindex="-1"><a class="header-anchor" href="#install"><span>install</span></a></h3><h3 id="cps" tabindex="-1"><a class="header-anchor" href="#cps"><span>CPS</span></a></h3><p>Common Package Specification 通用包描述文件 以后再看我现在还没用到</p><h3 id="cpack-生成安装包" tabindex="-1"><a class="header-anchor" href="#cpack-生成安装包"><span>CPack 生成安装包</span></a></h3></div></main><footer class="vp-doc-footer" data-v-dbb2a29f data-v-49e68d78><!--[--><!--]--><!----><div class="contributors" data-v-49e68d78><span class="contributors-label" data-v-49e68d78>贡献者: </span><span class="contributors-info" data-v-49e68d78><!--[--><!--[--><span class="contributor" data-v-49e68d78>ImoutoCon1999</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" data-v-49e68d78>Yuzhiy05</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-49e68d78><div class="pager" data-v-49e68d78><a class="vp-link no-icon link pager-link prev" href="/article/tlw73yi4/" data-v-49e68d78 data-v-5fc5bb72><!--[--><span class="desc" data-v-49e68d78>上一页</span><span class="title" data-v-49e68d78>c#数据类型</span><!--]--><!----></a></div><div class="pager" data-v-49e68d78><a class="vp-link no-icon link pager-link next" href="/article/i26uhz4h/" data-v-49e68d78 data-v-5fc5bb72><!--[--><span class="desc" data-v-49e68d78>下一页</span><span class="title" data-v-49e68d78>winFrom控件</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-8e3384c8 data-v-c9a60557><span class="percent" data-allow-mismatch data-v-c9a60557>0%</span><span class="show icon vpi-back-to-top" data-v-c9a60557></span><svg aria-hidden="true" data-v-c9a60557><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-c9a60557></circle></svg></button><footer class="vp-footer" vp-footer data-v-8e3384c8 data-v-cedb4a50><!--[--><div class="container" data-v-cedb4a50><p class="message" data-v-cedb4a50>Powered by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-BKjZcyMZ.js" defer></script></body></html>